{% extends 'core_admin/base.html' %}
{% load static %}

{% block title %}{{ edital.titulo }} - PONTI Admin{% endblock %}

{% block page_title %}Visualizar Edital{% endblock %}

{% block breadcrumb %}
<a href="{% url 'editais:admin_dashboard' %}" class="breadcrumb-item">Editais</a>
<span class="breadcrumb-item">
    <a href="{% url 'editais:admin_listar_editais' %}">Listar</a>
</span>
<span class="breadcrumb-item active">Visualizar</span>
{% endblock %}

{% block extra_css %}
<style>
.edital-header {
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
    color: white;
    border-radius: var(--radius-lg);
    padding: 32px;
    margin-bottom: 24px;
}

.edital-title {
    font-size: 2rem;
    font-weight: 800;
    margin: 0 0 8px 0;
    line-height: 1.2;
}

.edital-subtitle {
    font-size: 1.125rem;
    opacity: 0.9;
    margin: 0 0 16px 0;
    line-height: 1.4;
}

.edital-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    font-size: 0.875rem;
    opacity: 0.9;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--radius);
    font-weight: 600;
    margin-top: 16px;
}

.content-grid {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 24px;
}

.main-content {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.content-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    padding: 24px;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-200);
}

.section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.section-icon {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 14px;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.info-item {
    padding: 16px;
    background: var(--gray-50);
    border-radius: var(--radius);
    border-left: 4px solid var(--primary-blue);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--gray-500);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 4px;
}

.info-value {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray-900);
}

.areas-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
}

.area-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: var(--gray-100);
    color: var(--gray-700);
    border-radius: var(--radius-sm);
    font-size: 0.875rem;
    font-weight: 500;
}

.description-text {
    font-size: 0.875rem;
    line-height: 1.6;
    color: var(--gray-700);
    background: var(--gray-50);
    padding: 20px;
    border-radius: var(--radius);
    border-left: 4px solid var(--primary-blue);
}

.file-download {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: var(--gray-50);
    border-radius: var(--radius);
    border: 1px solid var(--gray-200);
    transition: var(--transition-fast);
}

.file-download:hover {
    background: var(--gray-100);
    border-color: var(--gray-300);
}

.file-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
}

.sidebar {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.stats-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    padding: 24px;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-200);
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--gray-100);
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-label {
    font-size: 0.875rem;
    color: var(--gray-600);
}

.stat-value {
    font-weight: 700;
    color: var(--gray-900);
}

.actions-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    padding: 24px;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-200);
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius);
    background: var(--white);
    color: var(--gray-700);
    text-decoration: none;
    font-weight: 600;
    transition: var(--transition-fast);
    margin-bottom: 12px;
}

.action-btn:last-child {
    margin-bottom: 0;
}

.action-btn:hover {
    border-color: var(--primary-blue);
    color: var(--primary-blue);
    transform: translateY(-1px);
}

.action-btn.primary {
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
    border-color: var(--primary-blue);
    color: white;
}

.action-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.action-btn.danger {
    border-color: var(--error);
    color: var(--error);
}

.action-btn.danger:hover {
    background: var(--error);
    color: white;
}

.notificacao-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border-radius: var(--radius);
    border: 1px solid var(--gray-200);
    margin-bottom: 8px;
    transition: var(--transition-fast);
}

.notificacao-item:hover {
    background: var(--gray-50);
}

.notificacao-avatar {
    width: 32px;
    height: 32px;
    background: var(--primary-blue);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
}

.timeline-item {
    display: flex;
    gap: 16px;
    padding: 16px 0;
    border-bottom: 1px solid var(--gray-100);
}

.timeline-item:last-child {
    border-bottom: none;
}

.timeline-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
    flex-shrink: 0;
}

.timeline-content h4 {
    margin: 0 0 4px 0;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray-900);
}

.timeline-content p {
    margin: 0;
    font-size: 0.75rem;
    color: var(--gray-500);
}

@media (max-width: 1024px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
    }
    
    .edital-meta {
        flex-direction: column;
        gap: 12px;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Header do Edital -->
<div class="edital-header">
    <h1 class="edital-title">{{ edital.titulo }}</h1>
    <p class="edital-subtitle">{{ edital.subtitulo }}</p>
    
    <div class="edital-meta">
        <div class="meta-item">
            <i class="fas fa-hashtag"></i>
            <span>{{ edital.numero_edital }}</span>
        </div>
        <div class="meta-item">
            <i class="fas fa-calendar"></i>
            <span>Criado em {{ edital.data_criacao|date:"d/m/Y H:i" }}</span>
        </div>
        {% if edital.criado_por %}
        <div class="meta-item">
            <i class="fas fa-user"></i>
            <span>{{ edital.criado_por.get_full_name|default:edital.criado_por.username }}</span>
        </div>
        {% endif %}
        <div class="meta-item">
            <i class="fas fa-eye"></i>
            <span>{{ edital.visualizacoes }} visualizações</span>
        </div>
    </div>
    
    <div class="status-badge">
        <i class="{{ edital.icone_status }}"></i>
        {{ edital.get_status_display }}
        {% if edital.destaque %}
        <i class="fas fa-star" style="margin-left: 8px; color: #fbbf24;"></i>
        {% endif %}
    </div>
</div>

<div class="content-grid">
    <!-- Conteúdo Principal -->
    <div class="main-content">
        <!-- Descrição -->
        <div class="content-card">
            <h3 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-align-left"></i>
                </div>
                Descrição
            </h3>
            <div class="description-text">
                {{ edital.descricao_completa|linebreaks }}
            </div>
        </div>
        
        <!-- Informações Básicas -->
        <div class="content-card">
            <h3 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                Informações Básicas
            </h3>
            
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Categoria</div>
                    <div class="info-value">
                        <i class="{{ edital.categoria.icone }}" style="color: {{ edital.categoria.cor }};"></i>
                        {{ edital.categoria.nome }}
                    </div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Modalidade</div>
                    <div class="info-value">{{ edital.get_modalidade_display }}</div>
                </div>
                
                {% if edital.numero_desafios %}
                <div class="info-item">
                    <div class="info-label">Desafios/Vagas</div>
                    <div class="info-value">{{ edital.numero_desafios }}</div>
                </div>
                {% endif %}
                
                {% if edital.valor_premio %}
                <div class="info-item">
                    <div class="info-label">Valor do Prêmio</div>
                    <div class="info-value">R$ {{ edital.valor_premio|floatformat:2 }}</div>
                </div>
                {% endif %}
            </div>
            
            <!-- Áreas de Interesse -->
            {% if edital.areas_interesse.all %}
            <div style="margin-top: 20px;">
                <div class="info-label">Áreas de Interesse</div>
                <div class="areas-list">
                    {% for area in edital.areas_interesse.all %}
                    <span class="area-badge" style="background: {{ area.cor }}20; color: {{ area.cor }};">
                        <i class="{{ area.icone }}"></i>
                        {{ area.nome }}
                    </span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Datas e Prazos -->
        <div class="content-card">
            <h3 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-calendar"></i>
                </div>
                Cronograma
            </h3>
            
            <div class="timeline-item">
                <div class="timeline-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <i class="fas fa-plus"></i>
                </div>
                <div class="timeline-content">
                    <h4>Criação do Edital</h4>
                    <p>{{ edital.data_criacao|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
            
            {% if edital.data_publicacao %}
            <div class="timeline-item">
                <div class="timeline-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="timeline-content">
                    <h4>Data de Publicação</h4>
                    <p>{{ edital.data_publicacao|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
            {% endif %}
            
            {% if edital.data_abertura %}
            <div class="timeline-item">
                <div class="timeline-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <i class="fas fa-door-open"></i>
                </div>
                <div class="timeline-content">
                    <h4>Abertura das Inscrições</h4>
                    <p>{{ edital.data_abertura|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
            {% endif %}
            
            <div class="timeline-item">
                <div class="timeline-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                    <i class="fas fa-lock"></i>
                </div>
                <div class="timeline-content">
                    <h4>Encerramento das Inscrições</h4>
                    <p>{{ edital.data_encerramento|date:"d/m/Y H:i" }}</p>
                    {% if edital.dias_restantes is not None %}
                    <p style="color: {% if edital.dias_restantes <= 7 %}var(--error){% else %}var(--gray-500){% endif %};">
                        {% if edital.dias_restantes > 0 %}
                            {{ edital.dias_restantes }} dias restantes
                        {% elif edital.dias_restantes == 0 %}
                            Encerra hoje
                        {% else %}
                            Encerrado há {{ edital.dias_restantes|add:"-1" }} dias
                        {% endif %}
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Arquivo do Edital -->
        {% if edital.arquivo_edital %}
        <div class="content-card">
            <h3 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                Arquivo do Edital
            </h3>
            
            <a href="{{ edital.arquivo_edital.url }}" target="_blank" class="file-download">
                <div class="file-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div style="flex: 1;">
                    <h4 style="margin: 0 0 4px 0; font-size: 0.875rem; font-weight: 600; color: var(--gray-900);">
                        {{ edital.arquivo_edital.name|slice:"10:" }}
                    </h4>
                    <p style="margin: 0; font-size: 0.75rem; color: var(--gray-500);">
                        Clique para fazer o download
                    </p>
                </div>
                <i class="fas fa-download" style="color: var(--gray-400);"></i>
            </a>
        </div>
        {% endif %}
        
        <!-- Links -->
        {% if edital.link_inscricao or edital.link_mais_informacoes %}
        <div class="content-card">
            <h3 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-link"></i>
                </div>
                Links Úteis
            </h3>
            
            <div style="display: flex; flex-direction: column; gap: 12px;">
                {% if edital.link_inscricao %}
                <a href="{{ edital.link_inscricao }}" target="_blank" class="action-btn primary">
                    <i class="fas fa-external-link-alt"></i>
                    Link de Inscrição
                </a>
                {% endif %}
                
                {% if edital.link_mais_informacoes %}
                <a href="{{ edital.link_mais_informacoes }}" target="_blank" class="action-btn">
                    <i class="fas fa-info-circle"></i>
                    Mais Informações
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Estatísticas -->
        <div class="stats-card">
            <h3 style="margin: 0 0 20px 0; font-size: 1.125rem; font-weight: 700; color: var(--gray-900);">
                Estatísticas
            </h3>
            
            <div class="stat-item">
                <span class="stat-label">Visualizações</span>
                <span class="stat-value">{{ edital.visualizacoes }}</span>
            </div>
            
            <div class="stat-item">
                <span class="stat-label">Notificações</span>
                <span class="stat-value">{{ total_notificacoes }}</span>
            </div>
            
            <div class="stat-item">
                <span class="stat-label">Pendentes</span>
                <span class="stat-value">{{ notificacoes_pendentes }}</span>
            </div>
            
            <div class="stat-item">
                <span class="stat-label">Status</span>
                <span class="stat-value" style="color: {{ edital.cor_status_calculada }};">
                    {{ edital.get_status_display }}
                </span>
            </div>
            
            <div class="stat-item">
                <span class="stat-label">Última Atualização</span>
                <span class="stat-value" style="font-size: 0.75rem;">
                    {{ edital.data_atualizacao|date:"d/m/Y H:i" }}
                </span>
            </div>
        </div>
        
        <!-- Ações -->
        <div class="actions-card">
            <h3 style="margin: 0 0 20px 0; font-size: 1.125rem; font-weight: 700; color: var(--gray-900);">
                Ações
            </h3>
            
            <a href="{% url 'editais:admin_editar_edital' edital.id %}" class="action-btn primary">
                <i class="fas fa-edit"></i>
                Editar Edital
            </a>
            
            <a href="{% url 'editais:admin_listar_editais' %}" class="action-btn">
                <i class="fas fa-list"></i>
                Voltar à Lista
            </a>
            
            {% if total_notificacoes > 0 %}
            <a href="{% url 'editais:listar_notificacoes' edital.slug %}" class="action-btn">
                <i class="fas fa-bell"></i>
                Ver Notificações
            </a>
            {% endif %}
            
            <a href="{% url 'editais:admin_deletar_edital' edital.id %}" class="action-btn danger">
                <i class="fas fa-trash"></i>
                Deletar Edital
            </a>
        </div>
        
        <!-- Notificações Recentes -->
        {% if notificacoes %}
        <div class="stats-card">
            <h3 style="margin: 0 0 20px 0; font-size: 1.125rem; font-weight: 700; color: var(--gray-900);">
                Últimas Notificações
            </h3>
            
            {% for notificacao in notificacoes %}
            <div class="notificacao-item">
                <div class="notificacao-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div style="flex: 1;">
                    <h4 style="margin: 0 0 2px 0; font-size: 0.875rem; font-weight: 600; color: var(--gray-900);">
                        {{ notificacao.nome_completo|default:notificacao.email|truncatechars:20 }}
                    </h4>
                    <p style="margin: 0; font-size: 0.75rem; color: var(--gray-500);">
                        {{ notificacao.data_solicitacao|date:"d/m H:i" }}
                    </p>
                </div>
            </div>
            {% endfor %}
            
            {% if total_notificacoes > 10 %}
            <div style="text-align: center; margin-top: 16px;">
                <a href="{% url 'editais:listar_notificacoes' edital.slug %}" class="btn btn-sm btn-secondary">
                    Ver Todas ({{ total_notificacoes }})
                </a>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}